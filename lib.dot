# Requires ${DOTFILES_DIR}
# Source after "${DOTFILES_DIR}/detect_docker.dot"

function dotfiles_install_zplug()
{
  local home=${1:-${HOME}}
  local tmp=${2:-$(mktemp -d)}

  if [[ ! -e "${home}/.zplug" ]]; then
    if [[ "1" == "$(detect_docker)" ]]; then
      git_proxy_args=""
      if [[ "" != "${http_proxy}" ]]; then
        git_proxy_args="--config=http.proxy=${http_proxy}"
      fi
      git clone ${git_proxy_args} https://github.com/zplug/zplug.git "${home}/.zplug"
      if [[ $? != 0 ]]; then
        echo "Couldn't clone zplug repo.  Is there a proxy blocking it?  Proxy env is:"
        env | grep -i proxy
      fi
    else
      curl -sL --proto-redir -all,https https://raw.githubusercontent.com/zplug/installer/master/installer.zsh > "${tmp}/install_zplug.sh"
      if [[ $? == 0 ]]; then
        zsh "${tmp}/install_zplug.sh"
      else
        echo "Couldn't download zplug installer.  Is there a proxy blocking it?  Proxy env is:"
        env | grep -i proxy
      fi
    fi
  fi
}

function dotfiles_install_rofi()
{
  local home=${1:-${HOME}}
  local tmp=${2:-$(mktemp -d)}

  ln -s "${DOTFILES_DIR}/config/rofi" "${home}/.config/"
}

function dotfiles_install_rofipass()
{
  local home=${1:-${HOME}}

  ln -s "${DOTFILES_DIR}/config/rofi-pass" "${home}/.config/"
}

function dotfiles_install_i3()
{
  local home=${1:-${HOME}}
  if [[ "$(which i3)" != "" ]]; then
    ln -s "${DOTFILES_DIR}/config/i3" "${h}/.config/"
  fi

  if [[ ! -e "${home}/bin" ]]; then
    mkdir -p "${home}/bin"
  fi

  cat <<<TOHERE > "${home}/bin/do_lock.sh"
#!/bin/bash

# Shuts the screen off the first time, but after a period of inactivity
# Assumes i3lock-fancy-rapid is installed
/usr/local/bin/i3lock-fancy-rapid 5 3 -t "Enter Password" -k --indicator -e \
    & sleep 5 \
    && xset dpms force off
TOHERE
}

function dotfiles_install_dein()
{
  local home=${1:-${HOME}}
  local tmp=${2:-$(mktemp -d)}

	if [[ ! -e "${DOTFILES_DIR}/bundles/dein" ]]; then
		curl https://raw.githubusercontent.com/Shougo/dein.vim/master/bin/installer.sh > "${tmp}/install_dein.sh"
		if [[ $? == 0 ]]; then
			sh "${tmp}/install_dein.sh" "${DOTFILES_DIR}/bundles/dein"
		else
			echo "Couldn't download dein installer.  Is there a proxy blocking it?  Proxy env is:"
			env | grep -i proxy
		fi
	fi
}

# vim: ts=2 sw=2 sts=0 ff=unix expandtab ft=sh :
