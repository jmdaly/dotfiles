#!/bin/zsh

function diff-dirs()
{
    local -r dir_a=$(realpath $1)
    local -r dir_b=$(realpath $2)

    if [[ "0" == $(_exists sd) ]]; then
        echo "Function relies on sd (TODO make it work with sed)" 1>&2
    fi

    local -a files=($(diff -q -w -x .git -r "${dir_a}" "${dir_b}" | sd '.*qnx-vsomeip.([^\s:]+).*' '$1'))
    # TODO also look for the "only" ones, can probably reuse the same diff result

    local cmd;
    local i=0
    for f in ${files[@]}; do
        if [[ ! -f "${dir_a}/${f}" || ! -f "${dir_b}/${f}" ]]; then
            continue
        fi
        if [[ "$(($i % 2))" == "0" ]]; then
            if [[ "0" == "$i" ]]; then
                cmd="-p "
            else
                cmd="${cmd} -c tabn "
            fi
            cmd="${cmd}${dir_a}/${f} "
        else
            cmd="${cmd}-c 'vs ${dir_b}/${f}'"
        fi

        i=$(($i+1))
    done
    echo vi $cmd
}

#  vim: set ts=2 sw=2 tw=0 et :
